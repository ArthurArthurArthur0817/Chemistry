<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>行為分類</title>
    <link rel="stylesheet" href="/static/rule.css">
</head>
<body>
    <h1>行為分類</h1>

    <!-- 教學提示圖片 -->
    <div id="instruction-popup" class="popup" style="display: none;">
        <p>此行為不正確，請再試一次！</p>
        <img src="/static/instruction.png" alt="教學圖片" style="width: 100%; max-width: 400px;">
        <button onclick="closePopup()">關閉</button>
    </div>

    <div class="container">
        <div id="safe-basket" class="basket safe" ondrop="drop(event, 'safe')" ondragover="allowDrop(event)">
            <div class="basket-title">安全行為</div>
        </div>
        <div id="danger-basket" class="basket danger" ondrop="drop(event, 'danger')" ondragover="allowDrop(event)">
            <div class="basket-title">可能危險的行為</div>
        </div>
    </div>

    <div class="actions">
        <div class="card" id="card1" draggable="true" ondragstart="drag(event)">佩戴護目鏡</div>
        <div class="card" id="card2" draggable="true" ondragstart="drag(event)">使用未經允許的化學品</div>
        <div class="card" id="card3" draggable="true" ondragstart="drag(event)">在通風處實驗</div>
        <div class="card" id="card4" draggable="true" ondragstart="drag(event)">徒手接觸化學品</div>
        <!-- 可以在這裡添加更多卡片 -->
    </div>

    <button class="submit-btn" onclick="submitClassification()">提交</button>

    <div id="message" class="message"></div>

    <script>
        // 定義正確的分類答案
        const correctSafe = ["佩戴護目鏡", "在通風處實驗"];
        const correctDanger = ["使用未經允許的化學品", "徒手接觸化學品"];

        // 拖放邏輯
        let draggedCard;
        let originalBasket = null;

        function drag(event) {
            draggedCard = event.target;
            originalBasket = draggedCard.parentNode;
        }

        function allowDrop(event) {
            event.preventDefault();
        }

        function drop(event, basketType) {
            event.preventDefault();
            const cardText = draggedCard.innerText;
            
            // 檢查是否放入錯誤的籃子
            if ((basketType === 'safe' && correctDanger.includes(cardText)) || 
                (basketType === 'danger' && correctSafe.includes(cardText))) {
                
                // 顯示教學圖片，並將卡片回到原位
                showPopup();
                originalBasket.appendChild(draggedCard);
            } else {
                // 放入正確的籃子
                event.target.appendChild(draggedCard);
            }
        }

        function showPopup() {
            document.getElementById("instruction-popup").style.display = "block";
        }

        function closePopup() {
            document.getElementById("instruction-popup").style.display = "none";
        }

        function submitClassification() {
            const safeBasketCards = Array.from(document.getElementById('safe-basket').children)
                                        .filter(card => card.classList.contains("card"))
                                        .map(card => card.innerText);
            const dangerBasketCards = Array.from(document.getElementById('danger-basket').children)
                                        .filter(card => card.classList.contains("card"))
                                        .map(card => card.innerText);

            const isCorrect = validateClassification(safeBasketCards, dangerBasketCards);
            
            const message = isCorrect ? "分類完成！" : "分類錯誤，請重新檢查！";
            document.getElementById("message").innerText = message;
            document.getElementById("message").classList.toggle("success", isCorrect);
            document.getElementById("message").classList.toggle("error", !isCorrect);
        }

        // 驗證用戶的分類是否正確
        function validateClassification(safe, danger) {
            const isCorrect = JSON.stringify(safe) === JSON.stringify(correctSafe) && 
                              JSON.stringify(danger) === JSON.stringify(correctDanger);
            return isCorrect;
        }
    </script>
</body>
</html>
